import{r as v,q as B,c as i,b as t,s as b,l as m,n as r,g as k,t as o,x as D,e as y,v as M,y as w,z,F as N,m as V,o as u,E as q}from"./index-DIcO2vH9.js";const W={class:"feedback-page"},G={class:"nav nav-tabs mb-4"},H={class:"nav-item"},J={class:"nav-item"},K={key:0,class:"badge bg-warning ms-1"},P={class:"card mb-4"},Q={class:"card-body"},X={class:"row g-3"},Y={class:"col-6 col-md-3"},Z={class:"col-6 col-md-3"},tt={class:"col-6 col-md-3"},st={class:"col-6 col-md-3"},et={class:"card"},lt={class:"card-body"},nt={class:"row g-3 mb-3"},ot={class:"col-md-6"},at={class:"form-label"},it={class:"col-md-6"},rt={class:"mb-3"},ut={class:"mb-4"},dt={key:0,class:"image-preview mt-2"},ct=["src","alt"],vt=["onClick"],pt={class:"card"},bt={class:"card-header d-flex justify-content-between align-items-center"},mt={class:"table-responsive"},gt={class:"table table-hover mb-0"},ft={class:"fw-semibold"},yt={class:"text-truncate",style:{"max-width":"200px"}},kt=["onClick"],wt={key:0},xt={class:"modal-content"},Ct={class:"modal-header"},Tt={class:"modal-body"},St={class:"detail-row"},Ft={class:"detail-row"},Ut={class:"detail-row"},$t={class:"detail-row"},_t={class:"detail-row"},Bt={class:"detail-row"},Dt={class:"detail-row"},Nt={key:0,class:"detail-row"},Vt={class:"text-success"},At={__name:"Feedback",setup(qt){const d=v("submit"),g=v(""),f=v(!1),a=v({}),x=v(null),n=v({type:"fault",location:"",urgency:"normal",description:"",images:[]}),p=v([{id:1,feedbackNo:"FB202401150001",type:"fault",location:"生产线A",urgency:"urgent",description:"生产线A电机异常响声，运行时有明显震动",createTime:"2024-01-15 10:30:00",status:"processing",reply:"已派维修人员前往检查"},{id:2,feedbackNo:"FB202401100002",type:"suggestion",location:"配电室",urgency:"normal",description:"建议增加配电室空调，夏季温度过高影响设备运行",createTime:"2024-01-10 14:20:00",status:"resolved",reply:"已采纳建议，计划下月安装空调设备"},{id:3,feedbackNo:"FB202401080003",type:"question",location:"",urgency:"normal",description:"请问如何查看历史用电数据？",createTime:"2024-01-08 09:15:00",status:"resolved",reply:"可在能耗查看页面查询历史数据"}]),C=B(()=>p.value.filter(l=>l.status==="processing"||l.status==="pending").length),L=B(()=>g.value?p.value.filter(l=>l.status===g.value):p.value);function T(l){return{fault:"故障报修",suggestion:"用电建议",question:"咨询问题",other:"其他反馈"}[l]||l}function S(l){return{fault:"bg-danger",suggestion:"bg-warning text-dark",question:"bg-info",other:"bg-secondary"}[l]||"bg-secondary"}function F(l){return{pending:"待处理",processing:"处理中",resolved:"已处理"}[l]||l}function U(l){return{pending:"badge-pending",processing:"badge-processing",resolved:"badge-approved"}[l]||""}function h(l){return{normal:"一般",urgent:"紧急",critical:"非常紧急"}[l]||l}function $(l){return l?l.substring(0,16):"-"}function A(){var l;(l=x.value)==null||l.click()}function R(l){const s=l.target.files;s&&Array.from(s).forEach(e=>{if(e.type.startsWith("image/")){const c=URL.createObjectURL(e);n.value.images.push({name:e.name,url:c,file:e})}})}function j(l){const s=l.dataTransfer.files;s&&Array.from(s).forEach(e=>{if(e.type.startsWith("image/")){const c=URL.createObjectURL(e);n.value.images.push({name:e.name,url:c,file:e})}})}function E(l){URL.revokeObjectURL(n.value.images[l].url),n.value.images.splice(l,1)}function _(){n.value={type:"fault",location:"",urgency:"normal",description:"",images:[]}}function I(){if(!n.value.description.trim()){q.warning("请填写问题描述");return}const l=new Date,e=`FB${l.toISOString().slice(0,10).replace(/-/g,"")}${String(p.value.length+1).padStart(4,"0")}`;p.value.unshift({id:Date.now(),feedbackNo:e,type:n.value.type,location:n.value.location,urgency:n.value.urgency,description:n.value.description,createTime:l.toISOString().slice(0,19).replace("T"," "),status:"pending",reply:""}),q.success("反馈提交成功"),_(),d.value="history"}function O(l){a.value=l,f.value=!0}return(l,s)=>(u(),i("div",W,[t("ul",G,[t("li",H,[t("button",{class:r(["nav-link",{active:d.value==="submit"}]),onClick:s[0]||(s[0]=e=>d.value="submit")},"提交反馈",2)]),t("li",J,[t("button",{class:r(["nav-link",{active:d.value==="history"}]),onClick:s[1]||(s[1]=e=>d.value="history")},[s[13]||(s[13]=k(" 我的反馈 ",-1)),C.value>0?(u(),i("span",K,o(C.value),1)):m("",!0)],2)])]),b(t("div",null,[t("div",P,[s[18]||(s[18]=t("div",{class:"card-header"},"选择反馈类型",-1)),t("div",Q,[t("div",X,[t("div",Y,[t("div",{class:r(["type-card",{active:n.value.type==="fault"}]),onClick:s[2]||(s[2]=e=>n.value.type="fault")},[...s[14]||(s[14]=[t("i",{class:"bi bi-tools fs-2 text-primary d-block mb-2"},null,-1),t("span",{class:"fw-semibold"},"故障报修",-1)])],2)]),t("div",Z,[t("div",{class:r(["type-card",{active:n.value.type==="suggestion"}]),onClick:s[3]||(s[3]=e=>n.value.type="suggestion")},[...s[15]||(s[15]=[t("i",{class:"bi bi-lightbulb fs-2 text-warning d-block mb-2"},null,-1),t("span",null,"用电建议",-1)])],2)]),t("div",tt,[t("div",{class:r(["type-card",{active:n.value.type==="question"}]),onClick:s[4]||(s[4]=e=>n.value.type="question")},[...s[16]||(s[16]=[t("i",{class:"bi bi-question-circle fs-2 text-info d-block mb-2"},null,-1),t("span",null,"咨询问题",-1)])],2)]),t("div",st,[t("div",{class:r(["type-card",{active:n.value.type==="other"}]),onClick:s[5]||(s[5]=e=>n.value.type="other")},[...s[17]||(s[17]=[t("i",{class:"bi bi-megaphone fs-2 text-secondary d-block mb-2"},null,-1),t("span",null,"其他反馈",-1)])],2)])])])]),t("div",et,[s[28]||(s[28]=t("div",{class:"card-header"},"填写反馈内容",-1)),t("div",lt,[t("form",{class:"feedback-form",onSubmit:y(I,["prevent"])},[t("div",nt,[t("div",ot,[t("label",at,o(n.value.type==="fault"?"故障位置":"相关位置"),1),b(t("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>n.value.location=e),class:"form-select"},[...s[19]||(s[19]=[M('<option value="">请选择</option><option value="生产线A">生产线A</option><option value="生产线B">生产线B</option><option value="配电室">配电室</option><option value="其他">其他</option>',5)])],512),[[w,n.value.location]])]),t("div",it,[s[21]||(s[21]=t("label",{class:"form-label"},"紧急程度",-1)),b(t("select",{"onUpdate:modelValue":s[7]||(s[7]=e=>n.value.urgency=e),class:"form-select"},[...s[20]||(s[20]=[t("option",{value:"normal"},"一般",-1),t("option",{value:"urgent"},"紧急",-1),t("option",{value:"critical"},"非常紧急",-1)])],512),[[w,n.value.urgency]])])]),t("div",rt,[s[22]||(s[22]=t("label",{class:"form-label"},[k("问题描述 "),t("span",{class:"text-danger"},"*")],-1)),b(t("textarea",{"onUpdate:modelValue":s[8]||(s[8]=e=>n.value.description=e),class:"form-control",rows:"4",placeholder:"请详细描述问题情况..."},null,512),[[z,n.value.description]])]),t("div",ut,[s[26]||(s[26]=t("label",{class:"form-label"},"上传图片",-1)),t("div",{class:"upload-area",onClick:A,onDragover:s[9]||(s[9]=y(()=>{},["prevent"])),onDrop:y(j,["prevent"])},[t("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/*",multiple:"",hidden:"",onChange:R},null,544),s[23]||(s[23]=t("i",{class:"bi bi-cloud-arrow-up fs-1 text-muted d-block mb-2"},null,-1)),s[24]||(s[24]=t("span",{class:"text-muted"},"点击或拖拽上传图片",-1))],32),n.value.images.length>0?(u(),i("div",dt,[(u(!0),i(N,null,V(n.value.images,(e,c)=>(u(),i("div",{key:c,class:"preview-item"},[t("img",{src:e.url,alt:e.name},null,8,ct),t("button",{type:"button",class:"remove-btn",onClick:Lt=>E(c)},[...s[25]||(s[25]=[t("i",{class:"bi bi-x"},null,-1)])],8,vt)]))),128))])):m("",!0)]),t("div",{class:"d-flex gap-2 justify-content-end"},[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:_},"取消"),s[27]||(s[27]=t("button",{type:"submit",class:"btn btn-primary"},[t("i",{class:"bi bi-send me-1"}),k("提交反馈")],-1))])],32)])])],512),[[D,d.value==="submit"]]),b(t("div",null,[t("div",pt,[t("div",bt,[s[30]||(s[30]=t("span",null,"我的反馈记录",-1)),b(t("select",{"onUpdate:modelValue":s[10]||(s[10]=e=>g.value=e),class:"form-select form-select-sm",style:{width:"auto"}},[...s[29]||(s[29]=[t("option",{value:""},"全部状态",-1),t("option",{value:"pending"},"待处理",-1),t("option",{value:"processing"},"处理中",-1),t("option",{value:"resolved"},"已处理",-1)])],512),[[w,g.value]])]),t("div",mt,[t("table",gt,[s[32]||(s[32]=t("thead",null,[t("tr",null,[t("th",null,"编号"),t("th",null,"类型"),t("th",null,"描述"),t("th",null,"提交时间"),t("th",null,"状态"),t("th",null,"操作")])],-1)),t("tbody",null,[(u(!0),i(N,null,V(L.value,e=>(u(),i("tr",{key:e.id},[t("td",ft,o(e.feedbackNo),1),t("td",null,[t("span",{class:r(["badge",S(e.type)])},o(T(e.type)),3)]),t("td",yt,o(e.description),1),t("td",null,o($(e.createTime)),1),t("td",null,[t("span",{class:r(["badge-status",U(e.status)])},o(F(e.status)),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary",onClick:c=>O(e)},"查看",8,kt)])]))),128)),p.value.length===0?(u(),i("tr",wt,[...s[31]||(s[31]=[t("td",{colspan:"6",class:"text-center text-muted py-4"},"暂无反馈记录",-1)])])):m("",!0)])])])])],512),[[D,d.value==="history"]]),f.value?(u(),i("div",{key:0,class:"modal-overlay",onClick:s[12]||(s[12]=y(e=>f.value=!1,["self"]))},[t("div",xt,[t("div",Ct,[s[33]||(s[33]=t("h5",null,"反馈详情",-1)),t("button",{class:"btn-close",onClick:s[11]||(s[11]=e=>f.value=!1)})]),t("div",Tt,[t("div",St,[s[34]||(s[34]=t("span",{class:"label"},"反馈编号：",-1)),t("span",null,o(a.value.feedbackNo),1)]),t("div",Ft,[s[35]||(s[35]=t("span",{class:"label"},"反馈类型：",-1)),t("span",{class:r(["badge",S(a.value.type)])},o(T(a.value.type)),3)]),t("div",Ut,[s[36]||(s[36]=t("span",{class:"label"},"相关位置：",-1)),t("span",null,o(a.value.location||"-"),1)]),t("div",$t,[s[37]||(s[37]=t("span",{class:"label"},"紧急程度：",-1)),t("span",null,o(h(a.value.urgency)),1)]),t("div",_t,[s[38]||(s[38]=t("span",{class:"label"},"问题描述：",-1)),t("span",null,o(a.value.description),1)]),t("div",Bt,[s[39]||(s[39]=t("span",{class:"label"},"提交时间：",-1)),t("span",null,o($(a.value.createTime)),1)]),t("div",Dt,[s[40]||(s[40]=t("span",{class:"label"},"当前状态：",-1)),t("span",{class:r(["badge-status",U(a.value.status)])},o(F(a.value.status)),3)]),a.value.reply?(u(),i("div",Nt,[s[41]||(s[41]=t("span",{class:"label"},"处理回复：",-1)),t("span",Vt,o(a.value.reply),1)])):m("",!0)])])])):m("",!0)]))}};export{At as default};
