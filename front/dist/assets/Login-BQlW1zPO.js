import{_ as C,u as B,r as m,a as U,c as E,b as d,d as o,w as a,e as F,f as p,g as f,h as M,o as S,E as g,i as z}from"./index-DIcO2vH9.js";const N={class:"login-container"},$={class:"login-card"},h={class:"register-link"},I={__name:"Login",setup(O){const b=M(),c=B(),_=m(),w=m(!1),n=U({username:"",password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};async function P(){await _.value.validate(),w.value=!0;try{const i=await c.doLogin(n.username,n.password);g.success("登录成功");const e=c.homePage;console.log("登录成功，跳转到:",e,"用户数据:",i),await b.push(e)}catch(i){g.error(i.message||"登录失败")}finally{w.value=!1}}const u=m(!1),y=m(),V=m(!1),r=U({username:"",name:"",email:"",phone:"",department:"",password:"",confirmPassword:""}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"}]};async function R(){if(await y.value.validate(),r.password!==r.confirmPassword){g.error("两次密码不一致");return}V.value=!0;try{await z(r),g.success("注册成功，请等待管理员分配角色"),u.value=!1}catch{}finally{V.value=!1}}return(i,e)=>{const t=p("el-input"),s=p("el-form-item"),v=p("el-button"),x=p("el-form"),q=p("el-dialog");return S(),E("div",N,[d("div",$,[e[14]||(e[14]=d("div",{class:"header"},[d("div",{class:"logo"},"⚡"),d("h1",null,"智能电能监控平台"),d("p",null,"Smart Energy Monitoring Platform")],-1)),o(x,{ref_key:"formRef",ref:_,model:n,rules:k,onSubmit:F(P,["prevent"])},{default:a(()=>[o(s,{prop:"username"},{default:a(()=>[o(t,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.username=l),placeholder:"请输入用户名","prefix-icon":"User",size:"large"},null,8,["modelValue"])]),_:1}),o(s,{prop:"password"},{default:a(()=>[o(t,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=l=>n.password=l),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(s,null,{default:a(()=>[o(v,{type:"primary","native-type":"submit",loading:w.value,size:"large",class:"login-btn"},{default:a(()=>[...e[12]||(e[12]=[f(" 登 录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),d("div",h,[e[13]||(e[13]=f(" 还没有账号？",-1)),d("a",{onClick:e[2]||(e[2]=l=>u.value=!0)},"立即注册")])]),o(q,{modelValue:u.value,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value=l),title:"注册账号",width:"400px"},{footer:a(()=>[o(v,{onClick:e[10]||(e[10]=l=>u.value=!1)},{default:a(()=>[...e[15]||(e[15]=[f("取消",-1)])]),_:1}),o(v,{type:"primary",loading:V.value,onClick:R},{default:a(()=>[...e[16]||(e[16]=[f("注册",-1)])]),_:1},8,["loading"])]),default:a(()=>[o(x,{ref_key:"regFormRef",ref:y,model:r,rules:L},{default:a(()=>[o(s,{prop:"username"},{default:a(()=>[o(t,{modelValue:r.username,"onUpdate:modelValue":e[3]||(e[3]=l=>r.username=l),placeholder:"用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(s,{prop:"name"},{default:a(()=>[o(t,{modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=l=>r.name=l),placeholder:"真实姓名","prefix-icon":"UserFilled"},null,8,["modelValue"])]),_:1}),o(s,{prop:"email"},{default:a(()=>[o(t,{modelValue:r.email,"onUpdate:modelValue":e[5]||(e[5]=l=>r.email=l),placeholder:"邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),o(s,{prop:"phone"},{default:a(()=>[o(t,{modelValue:r.phone,"onUpdate:modelValue":e[6]||(e[6]=l=>r.phone=l),placeholder:"手机号","prefix-icon":"Phone"},null,8,["modelValue"])]),_:1}),o(s,{prop:"department"},{default:a(()=>[o(t,{modelValue:r.department,"onUpdate:modelValue":e[7]||(e[7]=l=>r.department=l),placeholder:"部门","prefix-icon":"OfficeBuilding"},null,8,["modelValue"])]),_:1}),o(s,{prop:"password"},{default:a(()=>[o(t,{modelValue:r.password,"onUpdate:modelValue":e[8]||(e[8]=l=>r.password=l),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(s,{prop:"confirmPassword"},{default:a(()=>[o(t,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=l=>r.confirmPassword=l),type:"password",placeholder:"确认密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},j=C(I,[["__scopeId","data-v-4fea5554"]]);export{j as default};
