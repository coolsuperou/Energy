import{c as J,b as K,d as L,r as O}from"./application-Dl1OK2DR.js";import{_ as Q,r as f,a as E,k as X,c as H,d as a,w as l,f as s,D as Y,o as x,s as Z,j as ee,g as c,t as g,b as y,l as te,F as ae,E as w}from"./index-DIcO2vH9.js";const le={class:"approval-page"},oe={class:"card-header"},ne={__name:"Approval",setup(se){const k=f(!1),V=f(!1),A=f([]),v=f(!1),p=f("approve"),j=f(""),r=f(null),d=E({page:1,size:10,total:0}),n=E({comment:"",adjustedStartTime:null,adjustedEndTime:null}),T=async()=>{var o,e;k.value=!0;try{const i=await J({page:d.page,size:d.size});A.value=((o=i.data)==null?void 0:o.records)||[],d.total=((e=i.data)==null?void 0:e.total)||0}catch{}k.value=!1},S=o=>{r.value=o,p.value="approve",j.value="批准申请",C(),v.value=!0},U=o=>{r.value=o,p.value="adjust",j.value="调整并批准",C(),n.adjustedStartTime=o.startTime,n.adjustedEndTime=o.endTime,v.value=!0},D=o=>{r.value=o,p.value="reject",j.value="拒绝申请",C(),v.value=!0},C=()=>{n.comment="",n.adjustedStartTime=null,n.adjustedEndTime=null},B=async()=>{if(p.value==="reject"&&!n.comment){w.warning("请填写拒绝原因");return}V.value=!0;try{const o=r.value.id;p.value==="approve"?(await K(o,{comment:n.comment}),w.success("已批准")):p.value==="adjust"?(await L(o,n),w.success("已调整并批准")):(await O(o,{comment:n.comment}),w.success("已拒绝")),v.value=!1,T()}catch{}V.value=!1},F=o=>({normal:"info",urgent:"warning",critical:"danger"})[o]||"info",$=o=>({normal:"普通",urgent:"紧急",critical:"非常紧急"})[o]||o;return X(()=>{T()}),(o,e)=>{const i=s("el-button"),u=s("el-table-column"),M=s("el-tag"),h=s("el-table"),q=s("el-pagination"),I=s("el-card"),_=s("el-form-item"),z=s("el-time-picker"),P=s("el-input"),R=s("el-form"),W=s("el-dialog"),G=Y("loading");return x(),H("div",le,[a(I,null,{header:l(()=>[y("div",oe,[e[8]||(e[8]=y("span",null,"待审批申请",-1)),a(i,{type:"primary",link:"",onClick:T},{default:l(()=>[...e[7]||(e[7]=[c("刷新",-1)])]),_:1})])]),default:l(()=>[Z((x(),ee(h,{data:A.value,stripe:""},{default:l(()=>[a(u,{prop:"applicationNo",label:"申请编号",width:"160"}),a(u,{prop:"userName",label:"申请人",width:"100"}),a(u,{prop:"equipmentName",label:"设备",width:"120"}),a(u,{prop:"power",label:"功率(kW)",width:"90"}),a(u,{prop:"applyDate",label:"用电日期",width:"110"}),a(u,{label:"时间段",width:"130"},{default:l(({row:t})=>{var m,b;return[c(g((m=t.startTime)==null?void 0:m.substring(0,5))+" - "+g((b=t.endTime)==null?void 0:b.substring(0,5)),1)]}),_:1}),a(u,{prop:"urgency",label:"紧急程度",width:"100"},{default:l(({row:t})=>[a(M,{type:F(t.urgency)},{default:l(()=>[c(g($(t.urgency)),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"purpose",label:"用途","show-overflow-tooltip":""}),a(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[a(i,{type:"success",size:"small",onClick:m=>S(t)},{default:l(()=>[...e[9]||(e[9]=[c("批准",-1)])]),_:1},8,["onClick"]),a(i,{type:"warning",size:"small",onClick:m=>U(t)},{default:l(()=>[...e[10]||(e[10]=[c("调整",-1)])]),_:1},8,["onClick"]),a(i,{type:"danger",size:"small",onClick:m=>D(t)},{default:l(()=>[...e[11]||(e[11]=[c("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,k.value]]),a(q,{"current-page":d.page,"onUpdate:currentPage":e[0]||(e[0]=t=>d.page=t),"page-size":d.size,"onUpdate:pageSize":e[1]||(e[1]=t=>d.size=t),total:d.total,layout:"total, prev, pager, next",onCurrentChange:T,style:{"margin-top":"16px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),a(W,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t),title:j.value,width:"500px"},{footer:l(()=>[a(i,{onClick:e[5]||(e[5]=t=>v.value=!1)},{default:l(()=>[...e[12]||(e[12]=[c("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:B,loading:V.value},{default:l(()=>[...e[13]||(e[13]=[c("确认",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(R,{model:n,"label-width":"100px"},{default:l(()=>[a(_,{label:"申请编号"},{default:l(()=>{var t;return[y("span",null,g((t=r.value)==null?void 0:t.applicationNo),1)]}),_:1}),a(_,{label:"申请人"},{default:l(()=>{var t;return[y("span",null,g((t=r.value)==null?void 0:t.userName),1)]}),_:1}),a(_,{label:"原时间段"},{default:l(()=>{var t,m,b,N;return[y("span",null,g((m=(t=r.value)==null?void 0:t.startTime)==null?void 0:m.substring(0,5))+" - "+g((N=(b=r.value)==null?void 0:b.endTime)==null?void 0:N.substring(0,5)),1)]}),_:1}),p.value==="adjust"?(x(),H(ae,{key:0},[a(_,{label:"调整开始时间"},{default:l(()=>[a(z,{modelValue:n.adjustedStartTime,"onUpdate:modelValue":e[2]||(e[2]=t=>n.adjustedStartTime=t),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(_,{label:"调整结束时间"},{default:l(()=>[a(z,{modelValue:n.adjustedEndTime,"onUpdate:modelValue":e[3]||(e[3]=t=>n.adjustedEndTime=t),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})],64)):te("",!0),a(_,{label:"审批意见"},{default:l(()=>[a(P,{modelValue:n.comment,"onUpdate:modelValue":e[4]||(e[4]=t=>n.comment=t),type:"textarea",rows:3,placeholder:p.value==="reject"?"请填写拒绝原因":"可选填写审批意见"},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=Q(ne,[["__scopeId","data-v-a5272dba"]]);export{pe as default};
