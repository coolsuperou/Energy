import{a as x,b as w,r as A}from"./application-Dl1OK2DR.js";import{_ as T,r as u,k as R,c as i,b as s,t as e,v as N,d as I,w as L,f as W,l as E,F as p,m as b,o,g as r,n as c,C as V,E as g}from"./index-DIcO2vH9.js";const B={class:"dispatcher-home"},D={class:"stat-cards"},M={class:"stat-card"},P={class:"stat-info"},S={class:"stat-value"},U={class:"stat-card"},G={class:"stat-info"},j={class:"stat-value"},z={class:"stat-card"},F={class:"stat-info"},O={class:"stat-value"},$={class:"stat-card"},q={class:"stat-info"},H={class:"stat-value"},J={class:"content-grid"},K={class:"card load-monitor"},Q={class:"card-body"},X={class:"load-chart"},Y={width:"180",height:"180",viewBox:"0 0 180 180"},Z=["stroke-dashoffset"],ss={class:"load-value"},ts={class:"value"},as={class:"load-stats"},es={class:"load-stat"},ns={class:"value"},ds={class:"load-stat"},is={class:"value"},os={class:"card pending-approval"},ls={class:"card-header"},rs={class:"card-body"},cs={class:"order-header"},vs={class:"order-info"},us={class:"order-meta"},ps={class:"order-actions"},bs=["onClick"],gs=["onClick"],_s={key:0,class:"empty-state"},ms={class:"card"},ys={class:"card-body"},fs={class:"workshop-header"},hs={class:"workshop-name"},ks={class:"workshop-status"},Cs={class:"workshop-power"},xs={class:"progress-bar-wrapper"},ws={__name:"Index",setup(As){const d=u({pendingApproval:8,pendingAlerts:3,loadRate:78.5,todayDispatched:156,currentPower:2450,totalCapacity:3120}),l=u([]),_=u([{name:"生产一车间",current:98,limit:150,statusText:"正常",statusClass:"bg-success",barClass:"bg-success",percent:65},{name:"生产二车间",current:185,limit:150,statusText:"超限",statusClass:"bg-danger",barClass:"bg-danger",percent:100},{name:"装配车间",current:76,limit:120,statusText:"正常",statusClass:"bg-success",barClass:"bg-success",percent:63},{name:"仓储车间",current:84,limit:100,statusText:"预警",statusClass:"bg-warning text-dark",barClass:"bg-warning",percent:84}]);function m(n){return{CRITICAL:"bg-danger",URGENT:"bg-warning text-dark",NORMAL:"bg-secondary"}[n]||"bg-secondary"}function y(n){return{CRITICAL:"紧急",URGENT:"加急",NORMAL:"普通"}[n]||"待审批"}async function v(){try{const n=await x();if(n&&n.code===200&&n.data){const t=n.data.records||n.data||[];l.value=t.slice(0,3),d.value.pendingApproval=t.length||0}}catch(n){console.warn("加载待审批申请失败，使用空数据",n),l.value=[]}}async function f(n){try{(await w(n,{comment:"批准"})).code===200&&(g.success("审批成功"),v())}catch{}}async function h(n){try{(await A(n,{comment:"拒绝"})).code===200&&(g.success("已拒绝"),v())}catch{}}return R(()=>{v()}),(n,t)=>{const k=W("router-link");return o(),i("div",B,[s("div",D,[s("div",M,[t[1]||(t[1]=s("div",{class:"stat-icon orange"},[s("i",{class:"bi bi-clipboard-check"})],-1)),s("div",P,[s("div",S,e(d.value.pendingApproval),1),t[0]||(t[0]=s("div",{class:"stat-label"},"待审批申请",-1))])]),s("div",U,[t[3]||(t[3]=s("div",{class:"stat-icon red"},[s("i",{class:"bi bi-exclamation-triangle"})],-1)),s("div",G,[s("div",j,e(d.value.pendingAlerts),1),t[2]||(t[2]=s("div",{class:"stat-label"},"待处理预警",-1))])]),s("div",z,[t[5]||(t[5]=s("div",{class:"stat-icon blue"},[s("i",{class:"bi bi-speedometer2"})],-1)),s("div",F,[s("div",O,e(d.value.loadRate)+"%",1),t[4]||(t[4]=s("div",{class:"stat-label"},"当前负荷率",-1))])]),s("div",$,[t[7]||(t[7]=s("div",{class:"stat-icon green"},[s("i",{class:"bi bi-check-circle"})],-1)),s("div",q,[s("div",H,e(d.value.todayDispatched),1),t[6]||(t[6]=s("div",{class:"stat-label"},"今日已调度",-1))])])]),s("div",J,[s("div",K,[t[13]||(t[13]=s("div",{class:"card-header"},"全厂负荷监控",-1)),s("div",Q,[s("div",X,[(o(),i("svg",Y,[t[8]||(t[8]=s("circle",{cx:"90",cy:"90",r:"70",fill:"none",stroke:"#e2e8f0","stroke-width":"14"},null,-1)),s("circle",{cx:"90",cy:"90",r:"70",fill:"none",stroke:"url(#gradient)","stroke-width":"14","stroke-dasharray":440,"stroke-dashoffset":440-440*d.value.loadRate/100,"stroke-linecap":"round",transform:"rotate(-90 90 90)"},null,8,Z),t[9]||(t[9]=s("defs",null,[s("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[s("stop",{offset:"0%",style:{"stop-color":"#3b82f6"}}),s("stop",{offset:"100%",style:{"stop-color":"#8b5cf6"}})])],-1))])),s("div",ss,[s("div",ts,e(d.value.loadRate)+"%",1),t[10]||(t[10]=s("div",{class:"label"},"负荷率",-1))])]),s("div",as,[s("div",es,[s("div",ns,e(d.value.currentPower),1),t[11]||(t[11]=s("div",{class:"label"},"当前功率 (kW)",-1))]),s("div",ds,[s("div",is,e(d.value.totalCapacity),1),t[12]||(t[12]=s("div",{class:"label"},"总容量 (kW)",-1))])])])]),s("div",os,[s("div",ls,[t[15]||(t[15]=s("span",null,"待审批申请",-1)),I(k,{to:"/dispatcher/approval",class:"card-link"},{default:L(()=>[...t[14]||(t[14]=[r("查看全部 →",-1)])]),_:1})]),s("div",rs,[(o(!0),i(p,null,b(l.value,a=>(o(),i("div",{key:a.id,class:c(["order-card",{urgent:a.urgency==="CRITICAL"}])},[s("div",cs,[s("div",vs,[s("h6",null,e(a.workshopName||"车间")+" - "+e(a.purpose),1),s("div",us,[s("span",null,[t[16]||(t[16]=s("i",{class:"bi bi-calendar"},null,-1)),r(e(a.applyDate)+" "+e(a.startTime)+"-"+e(a.endTime),1)]),s("span",null,[t[17]||(t[17]=s("i",{class:"bi bi-lightning-charge"},null,-1)),r(e(a.power)+" kW",1)])])]),s("span",{class:c(["badge",m(a.urgency)])},e(y(a.urgency)),3)]),s("div",ps,[s("button",{class:"btn btn-success btn-sm",onClick:C=>f(a.id)},[...t[18]||(t[18]=[s("i",{class:"bi bi-check-lg"},null,-1),r("批准 ",-1)])],8,bs),t[19]||(t[19]=s("button",{class:"btn btn-outline-warning btn-sm"},"调整",-1)),s("button",{class:"btn btn-outline-danger btn-sm",onClick:C=>h(a.id)},"拒绝",8,gs)])],2))),128)),l.value.length===0?(o(),i("div",_s,[...t[20]||(t[20]=[s("i",{class:"bi bi-inbox"},null,-1),s("span",null,"暂无待审批申请",-1)])])):E("",!0)])]),t[22]||(t[22]=N('<div class="card" data-v-3ad96499><div class="card-header" data-v-3ad96499><span data-v-3ad96499>实时预警</span><a href="#" class="card-link" data-v-3ad96499>查看全部 →</a></div><div class="card-body" data-v-3ad96499><div class="notice-item error" data-v-3ad96499><i class="bi bi-exclamation-circle-fill" data-v-3ad96499></i><div class="notice-content" data-v-3ad96499><h6 data-v-3ad96499>生产二车间功率超限</h6><p data-v-3ad96499>当前功率 185kW，超出限额 150kW</p><div class="notice-actions" data-v-3ad96499><button class="btn btn-primary btn-sm" data-v-3ad96499>创建工单</button><button class="btn btn-outline-secondary btn-sm" data-v-3ad96499>查看详情</button></div></div></div><div class="notice-item warning" data-v-3ad96499><i class="bi bi-exclamation-triangle-fill" data-v-3ad96499></i><div class="notice-content" data-v-3ad96499><h6 data-v-3ad96499>仓储车间用电异常波动</h6><p data-v-3ad96499>功率波动幅度超过20%，建议检查</p><div class="notice-actions" data-v-3ad96499><button class="btn btn-primary btn-sm" data-v-3ad96499>创建工单</button><button class="btn btn-outline-secondary btn-sm" data-v-3ad96499>忽略</button></div></div></div></div></div>',1)),s("div",ms,[t[21]||(t[21]=s("div",{class:"card-header"},"各车间用电分配",-1)),s("div",ys,[(o(!0),i(p,null,b(_.value,a=>(o(),i("div",{key:a.name,class:"workshop-item"},[s("div",fs,[s("span",hs,e(a.name),1),s("div",ks,[s("span",{class:c(["badge",a.statusClass])},e(a.statusText),3),s("span",Cs,e(a.current)+"/"+e(a.limit)+" kW",1)])]),s("div",xs,[s("div",{class:c(["progress-bar",a.barClass]),style:V({width:a.percent+"%"})},null,6)])]))),128))])])])])}}},Ns=T(ws,[["__scopeId","data-v-3ad96499"]]);export{Ns as default};
